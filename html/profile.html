<!DOCTYPE html>
<html lang="en">
<head>
    <script src="https://www.gstatic.com/firebasejs/7.17.1/firebase.js"></script>
    <link rel="stylesheet" href="https://www.w3schools.com/w3css/4/w3.css">
    <link href="https://fonts.googleapis.com/css2?family=Barlow+Semi+Condensed:wght@600&display=swap" rel="stylesheet">
    <link rel="icon" href="../images/logo.png">
    <link rel="stylesheet" href="../css/main.css">    
    <link rel="stylesheet" href="../css/doctDashboard.css">
    <link href="https://fonts.googleapis.com/css2?family=Alata&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://www.w3schools.com/w3css/4/w3.css">
    <link href="https://fonts.googleapis.com/css2?family=Roboto&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="../css/appointment.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Samchikitsa</title>
</head>
<body>

    <div class="PC">
        <div class="header">
            <div class="brand"><img class="brand-img" src="../images/logo.png" alt="logo"></div>
            <div class="sam-title">
                <h3> SAMCHIKITSA </h3>
                <div class="quote-bg"><b id="btext"></b></div>
            </div>
            <div class="account">
                <img class="avatar" id="avatar" src="../images/avatar.png" alt="" srcset="">  
                <div class="account-detail">
                    <div class="account-detail-content"><a id="myprofile" onclick="ifuser()">My Profile</a></div>
                    <div class="account-detail-content"><a onclick="ifuser()">Edit User</a></div>
                    <div class="account-detail-content"><a onclick="signOut()">Logout</a></div>

                </div>  
            </div>
        </div>

        <nav>
            <a class="nav-link active" href="../index.html">Home</a>
            <a class="nav-link" href="about.html" >About Us</a>
            <a class="nav-link" href="testimonial.html">Testimonials</a>
            <a class="nav-link" href="us.html">Upcoming Services</a>
            <a class="nav-link" id="mdh" href="#">SignUp</a>
            
        <div class="signupContainer">
            <a href="signup.html"> Signup As user </a><br><hr>
            <a href="doctSignup.html"> Signup As doctor </a> <br><hr>
            <a href="doctPsycho.html"> Signup As psychiatrist </a>
        </div>
            <a class="nav-link" id="mdh2" href="#">Login</a>
            <div class="signupContainer2">
                <a href="login.html"> login As user </a><br><hr>
                <a href="doctSignup.html"> login As doctor </a> <br><hr>
                <a href="doctPsycho.html"> login As psychiatrist </a>
            </div>
            
        </nav>

            <div class="doct-dashboard">
                <div class="profile-data">
                    <div class="profile-photo">
                        <img id="profilePic" src="../images/avatar.png" alt="">
                    </div>
                    <div class="profile-info">
                        <b id="name">UserName: </b><br>
                        <b id="emailid">Email:  </b><br>
                        <b id="phone">Contact:   </b><br>
                        <button id="editProfile" onclick="showAddProfileData()" class="fa fa-edit">edit profile</button>
                    </div>
                </div>
            </div>

            <div class="profileEdit" id="profileEdit">
                <h3>edit account</h3>
                <label for="Dname">Display Name</label>
                <input type="text" name="Dname" id="Dname"><br>
                <label for="Dphone">Display Contact</label>
                <input type="number" name="Dphone" id="Dphone"><br>
                <label for="Demail"> Display Email</label>
                <input type="email" name="Demail" id="Demail"><br>
                <label for="Dpic">Display Picture</label>
                <input type="file" name="Dpic" id="Dpic"><br>
                <p>(jpg/jpeg) format only. and not more than 100kb</p>
                <p> * don't click signup until files successfully upload popup generates.</p>
                <input type="text" id="profile-url" style="display: none;">
                <button type="submit" onclick="addProfileData()">Save</button> 
                <button type="submit" onclick="hideAddProfileData()">Cancel</button>

            </div>


                <div id="myAppointments" style="display: none;">
            <div id="close"><button onclick="hide()">X | Close</button></div>
            <h1 style="text-align: center;">My Appointments</h1>

            <div id="teleconsult">
    
            </div>
            <div id="offline">
    
            </div>
            <div id="doorstep">
    
            </div>
            <div id="labtest">
    
            </div>
            
        </div>

            <h1 class="user-dashboard">User Dashboard</h1>
            <div class="navigator-user">
                <div class="navigator-link">
                    <div class="img-nav">
                        <img src="../images/opd.png" alt="">
                    </div>
                    <div class="link-nav"><a href="oflineOPD.html"> Book Appointments</a></div>    
                </div>

                <div class="navigator-link">
                    <div class="img-nav">
                        <img src="../images/myPrescription.png" alt="">
                    </div>
                    <div class="link-nav"><a href=""> My Prescrptions</a></div>    
                </div>

                <div class="navigator-link">
                    <div class="img-nav">
                        <img src="../images/myAppointment.png" alt="">
                    </div>
                    <div class="link-nav"><a onclick="myappointment();">My Appointments </a></div>    
                </div>

                <div class="navigator-link">
                    <div class="img-nav">
                        <img src="../images/searchDoctor.png" alt="">
                    </div>
                    <div class="link-nav"><a href="searchDoctors.html"> Search For A Doctor</a></div>    
                </div>

            </div>
            <footer class="footer-main">
                <div class="footer">
                    <div class="footer-content">
                        <strong>Samchikitsa</strong><br>
                        <a id="footer-link" href="../html/about.html">about</a><br>
                        <a id="footer-link" href="../html/aboutH.html">about homeopathy</a><br>
                        <a id="footer-link" href="../html/news.html">blog</a><br>
                        <a id="footer-link" href="career.html"> career</a><br>
                        <a id="footer-link" href="mailto: info@samchikitsa.com">support 24X7</a><br>
                    </div>
                    <div class="footer-content">
                        <strong>for patients</strong><br>
                        <a id="footer-link" href="searchDoctors.html">search for doctors</a><br>
                        <a id="footer-link" href="articles.html">health articles</a><br>
                        <a id="footer-link" href="HTC.html">consult a doctor</a><br>
                        <a id="footer-link" href="lab.html">book a lab test</a><br>
                        <a id="footer-link" href="BOA.html">offline appointments</a><br>
                        <a id="footer-link" href="subscription.html">subscriptions</a><br>
                    </div>
                    <div class="footer-content">
                        <strong>for homeopathic doctors</strong><br>
                        <a id="footer-link" href="doctSignup.html">join samchikitsa</a><br>
                        <a id="footer-link" href="sharecase.html">share your cases</a><br>
                    </div>
                    <div class="footer-content">
                        <strong>for psychologists</strong><br>
                        <a id="footer-link" href="doctpsycho.html">join samchikitsa</a><br>
                        <a id="footer-link" href="sharecase.html">share your cases</a><br>
                    </div>
                    <div class="footer-content">
                        <strong>social</strong><br>
                        <a id="footer-link" href="https://www.facebook.com/Samchikitsa/">Facebook</a><br>
                        <a id="footer-link" href="https://instagram.com/samchikitsa?igshid=8qu71uomafai">Instagram</a><br>
                        <a id="footer-link" href="#">Twitter</a><br>
                        <a id="footer-link" href="#">Linkedin</a><br>
                    </div>
                    <div class="footer-content">
                        <strong>more</strong><br>
                        <a id="footer-link" href="../html/pp.html">privacy policies</a><br>
                        <a id="footer-link" href="../html/tnc.html">terms & conditions</a><br>
                        <a id="footer-link" href="../html/disclaimer.html">disclaimer</a><br>
                    </div>
                </div>
                <div class="footer-img">
                    <h1>samchikitsa</h1>
                    <p>Copyright &copy; 2020. All rights reserved</p>
        
                </div>
            </footer>

    <script>
        var i = 0;
        var txt = 'Serving Complete Health & Well Being';
        var speed = 30;

        function typeWriter() {
            if (i < txt.length) {
                document.getElementById("btext").innerHTML += txt.charAt(i);
                i++;
                setTimeout(typeWriter, speed);
            }
        }
        typeWriter();
    </script>
    <script>
        function showAddProfileData(){
            document.getElementById("profileEdit").style.display = "block";
        }
        
        function hideAddProfileData(){
            document.getElementById("profileEdit").style.display = "none";
        }
    </script>
    <script>
        // Your web app's Firebase configuration
  // For Firebase JS SDK v7.20.0 and later, measurementId is optional
  var firebaseConfig = {
    apiKey: "AIzaSyDE9G1FeHjwTFzVpHx2nUE_ROpwyM7ipZw",
    authDomain: "samchikitsa-96a4d.firebaseapp.com",
    projectId: "samchikitsa-96a4d",
    storageBucket: "samchikitsa-96a4d.appspot.com",
    messagingSenderId: "901173838593",
    appId: "1:901173838593:web:2f30c443538c413e69d100",
    measurementId: "G-6TE1JXH2DZ"
  };
  // Initialize Firebase
  firebase.initializeApp(firebaseConfig);
  firebase.analytics();
        
      
      const db = firebase.firestore();
      const auth = firebase.auth();
    document.cookie = 'cross-site-cookie=bar; SameSite=None and Secure';
   


    auth.onAuthStateChanged(function(user){
    if(user){ 
        if(user.email){
            document.getElementById("myprofile").innerHTML = user.email;
            // User signed in successfully.
            if(db.collection("users").doc(user.uid).get("email") == ""){
                return db.collection("users").doc(user.uid).set({
                    email : user.email
                })
            }

        }
        if(user.phone){
            document.getElementById("myprofile").innerHTML = user.phone;
            // User signed in successfully.
            if(db.collection("users").doc(user.uid).get("email") == ""){
                return db.collection("users").doc(user.uid).set({
                    email : user.phone
                })
            }
      
        }
    }
    })


    var fileButton = document.getElementById("Dpic");
   fileButton.addEventListener('change', function(e){
        var file = e.target.files[0];
        const storageRef = firebase.storage().ref('userProfile/' +file.name);
        var uploadTask = storageRef.put(file);
        uploadTask.on('state_changed', function(snapshot){
            var progress = (snapshot.bytesTransfered/snapshot.totalbytes) *100;

        },function(error){
            //
        },function(){
            uploadTask.snapshot.ref.getDownloadURL().then( function(downloadURL){
                console.log('File available at', downloadURL);
                document.getElementById("profile-url").value = downloadURL; 
                alert("id uploaded")
            })
        })


    });
 

    function signOut(){
     auth.signOut();
     window.location.replace("login.html")
     alert('signed Out')
 }


function myappointment(){
    document.getElementById("myAppointments").style.display = "block"
}

function hide(){
    document.getElementById("myAppointments").style.display = "none"
}    
function showCart(){
        auth.onAuthStateChanged(function(user){
            if(user){
            document.getElementById("cartEdit").style.display = "block";
            }else{
            alert("user not signed in.");
            window.location.replace("login.html");
        }
        });
        }
        
    function hideProfileData(){
        document.getElementById("cartEdit").style.display = "none";
        }



function addProfileData(){
    if(document.getElementById("Demail").value == ""){
            alert("Email id required")
        }else if(document.getElementById("Dname").value == ""){
            alert("User name required")
        }else if(document.getElementById("Dphone").value == ""){
            alert("Phone number required")
        }else if(document.getElementById("profile-url").value == ""){
            alert("Profile photo required")
        }else{
            
            auth.onAuthStateChanged(function(user){
                if(user){
                        return db.collection('users').doc(user.uid).set({
                            email: document.getElementById("Demail").value,    
                            name : document.getElementById("Dname").value,
                            phone : document.getElementById("Dphone").value,
                            profilePhoto:document.getElementById("profile-url").value,
                            }).then(function(){
                                alert("Profile Updated Successfully");
                                window.location.reload();
                            })
                    }
                })
        }
    }


    auth.onAuthStateChanged(function(user){
    if(user){ 
        db.collection('users').doc(user.uid).get().then(doc => {

                document.getElementById("name").innerHTML += doc.data().name;
                document.getElementById("phone").innerHTML += doc.data().phone;
                document.getElementById("emailid").innerHTML += doc.data().email;
                document.getElementById("profilePic").src = doc.data().profilePhoto;

        })
    }else{
        alert('no active user');
    }
}) 




        
auth.onAuthStateChanged(function(user){
    if(user){           
        db.collection('users').doc(user.uid).collection('appointments').get().then((snapshot) =>{
            var Totalamount = 0;
        snapshot.docs.forEach(doc => {
            var mobile = doc.data().Mobile;
            var mode = doc.data().Mode;
            var Pname = doc.data().PatientName;
            var platform = doc.data().Platform;
            var date = doc.data().date;
            var time = doc.data().time;
            
            if(mode == "chat"){
                var amount = 129;
            }else if(mode == "call"){
                var amount = 199;
            }else if(mode == "video"){
                var amount = 299;
            }
            
            document.getElementById("teleconsult").innerHTML +="<div id='mycart'><span>"+mode+" Appointment</span> <br><b>Patient Name: "+Pname+"</b><br> <p>On "+date+"</p><br><p>At "+time+"</p><br><b>Via "+platform+"</b><br><strong>₹<strong id='Totalamount'> "+amount+"</strong></strong><br><button onclick='deleteId();'>Remove</button></div>"
            

        
        })
            


    });

              
    db.collection('users').doc(user.uid).collection('MoradabadOPD').get().then((snapshot) =>{
            var Totalamount = 0;
        snapshot.docs.forEach(doc => {
            var mobile = doc.data().Mobile;
            var gender = doc.data().Gender;
            var opd = doc.data().OPD;
            var time = doc.data().time;
            var age = doc.data().age;
            var amount = 499;
            var Pname = doc.data().PatientName;
            var date = doc.data().date;
            document.getElementById("offline").innerHTML +="<div id='mycart'><span>Offline Appointment at "+opd+"</span> <br><b>Patient Name: "+Pname+"</b><br><b>Gender: "+gender+"</b><br><b>Age: "+age+"</b><br><p>On "+date+"</p><br><p>At "+time+"</p><br><strong>₹<strong id='Totalamount'> "+amount+"</strong></strong><br></div>"
            

        
        })
            


    });
           
    db.collection('users').doc(user.uid).collection('oflineappointments').get().then((snapshot) =>{
            var Totalamount = 0;
        snapshot.docs.forEach(doc => {
            var mobile = doc.data().Mobile;
            var gender = doc.data().Gender;
            var opd = doc.data().OPD;
            var time = doc.data().time;
            var age = doc.data().age;
            var amount = 499;
            var Pname = doc.data().PatientName;
            var date = doc.data().date;
            document.getElementById("offline").innerHTML +="<div id='mycart'><span>Offline Appointment at "+opd+"</span> <br><b>Patient Name: "+Pname+"</b><br><b>Gender: "+gender+"</b><br><b>Age: "+age+"</b><br><p>On "+date+"</p><br><p>At "+time+"</p><br><strong>₹<strong id='Totalamount'> "+amount+"</strong></strong><br></div>"
            

        
        })
            


    });


    db.collection('users').doc(user.uid).collection('doorstep').get().then((snapshot) =>{
            var Totalamount = 0;
        snapshot.docs.forEach(doc => {
            var mobile = doc.data().Mobile;
            var gender = doc.data().Gender;
            var age = doc.data().age;
            
            var address = doc.data().address;
            var city= doc.data().City;
            var pincode = doc.data().pincode;
            var landmark = doc.data().landmark;
            var amount = 499;
            var Pname = doc.data().PatientName;
            var date = doc.data().date;
            document.getElementById("doorstep").innerHTML +="<div id='mycart'><span>Doctor At Doorstep</span> <br><b>Patient Name: "+Pname+"</b><br><b>Gender: "+gender+"</b><br><b>Age: "+age+"</b><br><b>Address: "+address+"</b><br><b>City: "+city+"</b><br><b>Pincode: "+pincode+"</b><br><b>Landmark: "+landmark+"</b><br><p>On "+date+"</p><br><strong>₹<strong id='Totalamount'> "+amount+"</strong></strong><br></div>"
            

        
        })
            


    });

    
    }else{
        alert("signin first");
        window.location.replace("login.html")
    }
})


    </script>


</body>
</html>

